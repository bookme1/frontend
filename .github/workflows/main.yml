# .github/workflows/deploy-frontend.yml

on:
    push:
        branches:
            - main

name: ðŸš€ Deploy Frontend on Push

jobs:
    frontend-deploy:
        name: ðŸŽ‰ Deploy Frontend
        runs-on: ubuntu-latest
        steps:
            # Step 1: Clone repo
            - name: ðŸšš Get latest code
              uses: actions/checkout@v4

            # Step 2: Build Docker Image
            - name: ðŸ”¨ Build Docker Image
              run: |
                  docker build -t my-frontend:latest .

            # Step 3: Connect through SSH
            - name: ðŸ”‘ Set up SSH
              uses: webfactory/ssh-agent@v0.5.3
              with:
                  ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

            # Step 4: Load Docker image on server
            - name: ðŸš€ Push Docker Image to server
              run: |
                  docker save my-frontend:latest | ssh ${{ secrets.SSH_USERNAME }}@${{ secrets.SSH_HOST }} "docker load"

            # Step 5: Restart container on server
            - name: ðŸ”„ Restart Docker Container
              run: |
                  ssh ${{ secrets.SSH_USERNAME }}@${{ secrets.SSH_HOST }} "
                  docker stop frontend-container || true &&
                  docker rm frontend-container || true &&
                  docker run -d --name frontend-container -p 80:3000 my-frontend:latest
                  "
